(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[27],{"1XtG":function(e,n,t){e.exports=t.p+"static/useEffect-update-WorkInProgressHook-2.19e9ae54.png"},"4dQB":function(e,n,t){e.exports=t.p+"static/beginWork.1f6efe6d.png"},"4z7d":function(e,n,t){e.exports=t.p+"static/dispatchAction.162c6e74.png"},AbAg:function(e,n,t){e.exports=t.p+"static/useEffect-create-WorkInProgressHook.45e7d72b.png"},JjdP:function(e,n,t){"use strict";t.r(n);var a=t("HaE+"),r=t("o0o1"),o=t.n(r),l=t("LtsZ");n["default"]={"dfs-demo":{component:Object(l["dynamic"])({loader:function(){var e=Object(a["a"])(o.a.mark((function e(){var n,a,r,l,c,u,s,i,d;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t("TqRt"),e.t0=a,e.next=4,t.e(5).then(t.bind(null,"1OyB"));case 4:return e.t1=e.sent,r=(0,e.t0)(e.t1),e.t2=a,e.next=9,t.e(6).then(t.bind(null,"vuIU"));case 9:return e.t3=e.sent,l=(0,e.t2)(e.t3),e.t4=a,e.next=14,t.e(7).then(t.bind(null,"Ji7U"));case 14:return e.t5=e.sent,c=(0,e.t4)(e.t5),e.t6=a,e.next=19,t.e(4).then(t.bind(null,"LK+K"));case 19:return e.t7=e.sent,u=(0,e.t6)(e.t7),s=function(e){(0,c["default"])(a,e);var t=(0,u["default"])(a);function a(){return(0,r["default"])(this,a),t.apply(this,arguments)}return(0,l["default"])(a,[{key:"render",value:function(){return n.createElement("div",{className:"app"},n.createElement("header",null,"header"),n.createElement(i,null),n.createElement("footer",null,"footer"))}}]),a}(n.Component),i=function(e){(0,c["default"])(a,e);var t=(0,u["default"])(a);function a(){return(0,r["default"])(this,a),t.apply(this,arguments)}return(0,l["default"])(a,[{key:"render",value:function(){return n.createElement(n.Fragment,null,n.createElement("p",null,"1"),n.createElement("p",null,"2"),n.createElement("p",null,"3"))}}]),a}(n.Component),d=s,e.abrupt("return",d);case 25:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()}),previewerProps:{sources:{_:{jsx:'class App extends React.Component {\n  render() {\n    return (\n      <div className="app">\n        <header>header</header>\n        <Content />\n        <footer>footer</footer>\n      </div>\n    );\n  }\n}\n\nclass Content extends React.Component {\n  render() {\n    return (\n      <React.Fragment>\n        <p>1</p>\n        <p>2</p>\n        <p>3</p>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default App;'}},dependencies:{},identifier:"dfs-demo"}},"01-setstate-demo":{component:Object(l["dynamic"])({loader:function(){var e=Object(a["a"])(o.a.mark((function e(){var n,a,r,l,c,u,s;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t("TqRt"),e.t0=n,e.next=4,t.e(5).then(t.bind(null,"1OyB"));case 4:return e.t1=e.sent,a=(0,e.t0)(e.t1),e.t2=n,e.next=9,t.e(6).then(t.bind(null,"vuIU"));case 9:return e.t3=e.sent,r=(0,e.t2)(e.t3),e.t4=n,e.next=14,t.e(7).then(t.bind(null,"Ji7U"));case 14:return e.t5=e.sent,l=(0,e.t4)(e.t5),e.t6=n,e.next=19,t.e(4).then(t.bind(null,"LK+K"));case 19:return e.t7=e.sent,c=(0,e.t6)(e.t7),e.t8=n,e.next=24,Promise.resolve().then(t.t.bind(null,"q1tI",7));case 24:return e.t9=e.sent,u=(0,e.t8)(e.t9),s=function(e){(0,l["default"])(t,e);var n=(0,c["default"])(t);function t(){var e;(0,a["default"])(this,t);for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return e=n.call.apply(n,[this].concat(o)),e.state={count:0},e.changeState=function(){var n=e.state.count+1;e.setState({count:e.state.count+1}),n===e.state.count?console.log("\u540c\u6b65\u6267\u884crender"):console.log("\u5f02\u6b65\u6267\u884crender")},e.changeState2=function(){var n=e.state.count+1;Promise.resolve().then((function(){e.setState({count:e.state.count+1}),n===e.state.count?console.log("\u540c\u6b65\u6267\u884crender"):console.log("\u5f02\u6b65\u6267\u884crender")}))},e}return(0,r["default"])(t,[{key:"render",value:function(){return u["default"].createElement("div",null,u["default"].createElement("p",null,"\u5f53\u524dcount=",this.state.count),u["default"].createElement("button",{onClick:this.changeState},"\u5f02\u6b65+1"),u["default"].createElement("button",{onClick:this.changeState2},"\u540c\u6b65+1"))}}]),t}(u["default"].Component),e.abrupt("return",s);case 28:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()}),previewerProps:{sources:{_:{jsx:"import React from 'react';\n\nexport default class App extends React.Component {\n  state = {\n    count: 0,\n  };\n\n  changeState = () => {\n    const newCount = this.state.count + 1;\n    this.setState({\n      count: this.state.count + 1,\n    });\n    if (newCount === this.state.count) {\n      console.log('\u540c\u6b65\u6267\u884crender');\n    } else {\n      console.log('\u5f02\u6b65\u6267\u884crender');\n    }\n  };\n\n  changeState2 = () => {\n    const newCount = this.state.count + 1;\n    Promise.resolve().then(() => {\n      this.setState({\n        count: this.state.count + 1,\n      });\n      if (newCount === this.state.count) {\n        console.log('\u540c\u6b65\u6267\u884crender');\n      } else {\n        console.log('\u5f02\u6b65\u6267\u884crender');\n      }\n    });\n  };\n\n  render() {\n    return (\n      <div>\n        <p>\u5f53\u524dcount={this.state.count}</p>\n        <button onClick={this.changeState}>\u5f02\u6b65+1</button>\n        <button onClick={this.changeState2}>\u540c\u6b65+1</button>\n      </div>\n    );\n  }\n}"}},dependencies:{react:{version:"17.0.2"}},identifier:"01-setstate-demo"}},"hook-state-demo":{component:Object(l["dynamic"])({loader:function(){var e=Object(a["a"])(o.a.mark((function e(){var n,a,r,l,c,u;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return u=function(){var e=(0,r.useState)(0),n=(0,a["default"])(e,2),t=n[0],o=n[1];return r["default"].createElement("button",{onClick:function(){o(1),o(3),o(2)}},t)},c=function(e,n){if(!n&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var t=l(n);if(t&&t.has(e))return t.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var c=r?Object.getOwnPropertyDescriptor(e,o):null;c&&(c.get||c.set)?Object.defineProperty(a,o,c):a[o]=e[o]}return a["default"]=e,t&&t.set(e,a),a},l=function(e){if("function"!==typeof WeakMap)return null;var n=new WeakMap,t=new WeakMap;return(l=function(e){return e?t:n})(e)},n=t("TqRt"),e.t0=n,e.next=7,t.e(3).then(t.bind(null,"ODXe"));case 7:return e.t1=e.sent,a=(0,e.t0)(e.t1),e.t2=c,e.next=12,Promise.resolve().then(t.t.bind(null,"q1tI",7));case 12:return e.t3=e.sent,r=(0,e.t2)(e.t3),e.abrupt("return",u);case 15:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()}),previewerProps:{sources:{_:{jsx:"import React, { useState } from 'react';\nexport default function App() {\n  const [count, dispatch] = useState(0);\n  return (\n    <button\n      onClick={() => {\n        dispatch(1);\n        dispatch(3);\n        dispatch(2);\n      }}\n    >\n      {count}\n    </button>\n  );\n}"}},dependencies:{react:{version:"17.0.2"}},identifier:"hook-state-demo"}},"hook-summary-demo":{component:Object(l["dynamic"])({loader:function(){var e=Object(a["a"])(o.a.mark((function e(){var n,a,r,l,c,u;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return u=function(){var e=(0,r.useState)(1),n=(0,a["default"])(e,2),t=n[0],o=n[1];(0,r.useEffect)((function(){console.log("effect 1 created")}));var l=(0,r.useState)(2),c=(0,a["default"])(l,1),u=c[0];return(0,r.useEffect)((function(){console.log("effect 2 created")})),r["default"].createElement(r["default"].Fragment,null,r["default"].createElement("button",{onClick:function(){return o(t+1)}},t),r["default"].createElement("button",null,u))},c=function(e,n){if(!n&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var t=l(n);if(t&&t.has(e))return t.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var c=r?Object.getOwnPropertyDescriptor(e,o):null;c&&(c.get||c.set)?Object.defineProperty(a,o,c):a[o]=e[o]}return a["default"]=e,t&&t.set(e,a),a},l=function(e){if("function"!==typeof WeakMap)return null;var n=new WeakMap,t=new WeakMap;return(l=function(e){return e?t:n})(e)},n=t("TqRt"),e.t0=n,e.next=7,t.e(3).then(t.bind(null,"ODXe"));case 7:return e.t1=e.sent,a=(0,e.t0)(e.t1),e.t2=c,e.next=12,Promise.resolve().then(t.t.bind(null,"q1tI",7));case 12:return e.t3=e.sent,r=(0,e.t2)(e.t3),e.abrupt("return",u);case 15:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()}),previewerProps:{sources:{_:{jsx:"import React, { useState, useEffect } from 'react';\nexport default function App() {\n  // 1. useState\n  const [a, setA] = useState(1);\n  // 2. useEffect\n  useEffect(() => {\n    console.log(`effect 1 created`);\n  });\n  // 3. useState\n  const [b] = useState(2);\n  // 4. useEffect\n  useEffect(() => {\n    console.log(`effect 2 created`);\n  });\n  return (\n    <>\n      <button onClick={() => setA(a + 1)}>{a}</button>\n      <button>{b}</button>\n    </>\n  );\n}"}},dependencies:{react:{version:"17.0.2"}},identifier:"hook-summary-demo"}},"hook-demo":{component:Object(l["dynamic"])({loader:function(){var e=Object(a["a"])(o.a.mark((function e(){var n,a,r,l,c,u,s;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return u=function(){Promise.resolve().then((function(){console.log("\u6240\u6709\u7684effect.create\u90fd\u662f\u901a\u8fc7\u8c03\u5ea6\u5668(scheduler)\u5f02\u6b65(MessageChannel)\u6267\u884c\u7684, \u6545effect.create\u51fd\u6570\u5fc5\u7136\u5728\u6b64\u4e4b\u540e\u6267\u884c")}));var e=(0,r.useState)(0),n=(0,a["default"])(e,2),t=n[0],o=n[1];return(0,r.useEffect)((function(){return console.log("\u7b2c1\u4e2aeffect.create dps: []"),function(){console.log("\u7b2c1\u4e2aeffect.destory")}}),[]),(0,r.useEffect)((function(){return console.log("effect.create dps: [count]",t),function(){console.log("\u7b2c2\u4e2aeffect.destory dps: [count]",t)}}),[t]),r["default"].createElement(r["default"].Fragment,null,r["default"].createElement("p",null,"You clicked ",t," times"),r["default"].createElement("button",{onClick:function(){return o(t+1)}},"Click me"))},c=function(e,n){if(!n&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var t=l(n);if(t&&t.has(e))return t.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var c=r?Object.getOwnPropertyDescriptor(e,o):null;c&&(c.get||c.set)?Object.defineProperty(a,o,c):a[o]=e[o]}return a["default"]=e,t&&t.set(e,a),a},l=function(e){if("function"!==typeof WeakMap)return null;var n=new WeakMap,t=new WeakMap;return(l=function(e){return e?t:n})(e)},n=t("TqRt"),e.t0=n,e.next=7,t.e(3).then(t.bind(null,"ODXe"));case 7:return e.t1=e.sent,a=(0,e.t0)(e.t1),e.t2=c,e.next=12,Promise.resolve().then(t.t.bind(null,"q1tI",7));case 12:return e.t3=e.sent,r=(0,e.t2)(e.t3),s=u,e.abrupt("return",s);case 16:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()}),previewerProps:{sources:{_:{jsx:"import React, { useState, useEffect } from 'react';\nfunction Example() {\n  Promise.resolve().then(() => {\n    console.log(\n      '\u6240\u6709\u7684effect.create\u90fd\u662f\u901a\u8fc7\u8c03\u5ea6\u5668(scheduler)\u5f02\u6b65(MessageChannel)\u6267\u884c\u7684, \u6545effect.create\u51fd\u6570\u5fc5\u7136\u5728\u6b64\u4e4b\u540e\u6267\u884c',\n    );\n  });\n  // \u7b2c1\u4e2ahook(useState)\n  const [count, setCount] = useState(0);\n  // \u7b2c2\u4e2ahook(useEffect)\n  useEffect(() => {\n    console.log('\u7b2c1\u4e2aeffect.create dps: []');\n    return () => {\n      console.log('\u7b2c1\u4e2aeffect.destory');\n    };\n  }, []);\n  // \u7b2c3\u4e2ahook(useEffect)\n  useEffect(() => {\n    console.log('effect.create dps: [count]', count);\n    return () => {\n      console.log('\u7b2c2\u4e2aeffect.destory dps: [count]', count);\n    };\n  }, [count]);\n  return (\n    <>\n      <p>You clicked {count} times</p>\n      <button onClick={() => setCount(count + 1)}>Click me</button>\n    </>\n  );\n}\nexport default Example;"}},dependencies:{react:{version:"17.0.2"}},identifier:"hook-demo"}}}},Kn9z:function(e,n,t){e.exports=t.p+"static/useEffect-update-WorkInProgressHook-1.ed05b8b1.png"},"LA/F":function(e,n,t){e.exports=t.p+"static/hook-update.3632a969.png"},MZF8:function(e,n,t){"use strict";var a=t("ogwx");t.d(n,"a",(function(){return a["b"]}));t("VCU9")},O1S9:function(e,n,t){"use strict";t.r(n);var a=t("q1tI"),r=t.n(a),o=t("dEAq"),l=t("Zxc8"),c=t("H1Ra"),u=t("JjdP"),s=r.a.memo(u["default"]["hook-demo"].component);n["default"]=e=>(r.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&o["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h1",{id:"hook-\u539f\u7406"},r.a.createElement(o["AnchorLink"],{to:"#hook-\u539f\u7406","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"hook \u539f\u7406"),r.a.createElement("p",null,"\u9996\u5148\u5f15\u5165\u5b98\u7f51\u4e0a\u5bf9",r.a.createElement(o["Link"],{to:"https://zh-hans.reactjs.org/docs/hooks-intro.html"},"hook \u7684\u89e3\u91ca"),"."),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("code",null,"hook"),"\u53ea\u80fd\u7528\u4e8e",r.a.createElement("code",null,"function"),"\u4e2d"),r.a.createElement("li",null,"\u53ef\u4ee5\u4f7f\u7528",r.a.createElement("code",null,"state"),"\u4ee5\u53ca\u5176\u4ed6\u7684",r.a.createElement("code",null,"React"),"\u7279\u6027")),r.a.createElement("p",null,"\u6f14\u793a\u4ee3\u7801:")),r.a.createElement(l["default"],u["default"]["hook-demo"].previewerProps,r.a.createElement(s,null)),r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"\u65b0\u589e\u9636\u6bb5"},r.a.createElement(o["AnchorLink"],{to:"#\u65b0\u589e\u9636\u6bb5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u65b0\u589e\u9636\u6bb5"),r.a.createElement("h3",{id:"\u521b\u5efa-fiber"},r.a.createElement(o["AnchorLink"],{to:"#\u521b\u5efa-fiber","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u521b\u5efa fiber"),r.a.createElement("p",null,"\u901a\u8fc7",r.a.createElement(o["AnchorLink"],{to:"./render#beginWork"},"fiber \u6784\u5efa(\u65b0\u589e\u8282\u70b9)"),"\u4e2d\u7684\u4ecb\u7ecd, \u521b\u5efa\u8282\u70b9\u90fd\u662f\u5728",r.a.createElement("code",null,"beginWork"),"\u9636\u6bb5."),r.a.createElement("p",null,r.a.createElement("code",null,"function"),"\u7c7b\u578b\u8282\u70b9\u5728\u65b0\u589e\u65f6\u8c03\u7528",r.a.createElement("code",null,"mountIndeterminateComponent")),r.a.createElement(c["a"],{code:"// \u7701\u7565\u4e86\u4e0e\u521b\u5efafiber\u65e0\u5173\u7684\u903b\u8f91\nfunction mountIndeterminateComponent(\n  _current,\n  workInProgress,\n  Component,\n  renderExpirationTime,\n) {\n  const props = workInProgress.pendingProps;\n  let value;\n  value = renderWithHooks(\n    null,\n    workInProgress,\n    Component,\n    props,\n    context,\n    renderExpirationTime,\n  );\n  // React DevTools reads this flag.\n  workInProgress.effectTag |= PerformedWork;\n  // Proceed under the assumption that this is a function component\n  workInProgress.tag = FunctionComponent;\n  reconcileChildren(null, workInProgress, value, renderExpirationTime);\n  return workInProgress.child;\n}",lang:"js"}),r.a.createElement("p",null,"\u6838\u5fc3\u6b65\u9aa4:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u8c03\u7528",r.a.createElement("code",null,"renderWithHooks"),"(\u76ee\u7684\u548c\u8c03\u7528",r.a.createElement("code",null,"classInstance.render"),"\u4e00\u6837),\u8fd4\u56de\u4ee3\u8868\u5b50\u8282\u70b9\u7684",r.a.createElement("code",null,"reactElement")),r.a.createElement("li",null,"\u5c06\u6b65\u9aa4 1 \u4e2d\u5f97\u5230\u7684",r.a.createElement("code",null,"reactElement"),"\u4f20\u5165",r.a.createElement("code",null,"reconcileChildren"),"\u4e2d\u53bb\u6784\u5efa",r.a.createElement("code",null,"fiber"),"\u6b21\u7ea7\u5b50\u8282\u70b9")),r.a.createElement("p",null,"\u903b\u8f91\u8fdb\u5165",r.a.createElement("code",null,"ReactFiberHooks"),"\u4e2d, \u8fd9\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u5de5\u4f5c\u7a7a\u95f4, \u7ba1\u7406\u6240\u6709\u7684",r.a.createElement("code",null,"hook"),"\u5bf9\u8c61."),r.a.createElement(c["a"],{code:"export function renderWithHooks<Props, SecondArg>(\n  current: Fiber | null,\n  workInProgress: Fiber,\n  Component: (p: Props, arg: SecondArg) => any,\n  props: Props,\n  secondArg: SecondArg,\n  nextRenderExpirationTime: ExpirationTime,\n): any {\n  renderExpirationTime = nextRenderExpirationTime;\n  currentlyRenderingFiber = workInProgress;\n\n  workInProgress.memoizedState = null;\n  workInProgress.updateQueue = null;\n  workInProgress.expirationTime = NoWork;\n\n  // 1.\u8bbe\u7f6e\u5168\u5c40HooksDispatcher\n  ReactCurrentDispatcher.current =\n    current === null || current.memoizedState === null\n      ? HooksDispatcherOnMount\n      : HooksDispatcherOnUpdate;\n  // 2.\u6267\u884c`Component`\n  let children = Component(props, secondArg);\n\n  renderExpirationTime = NoWork;\n  currentlyRenderingFiber = (null: any);\n  currentHook = null;\n  workInProgressHook = null;\n  didScheduleRenderPhaseUpdate = false;\n  return children;\n}",lang:"js"}),r.a.createElement("p",null,"\u6838\u5fc3\u6b65\u9aa4:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u8bbe\u7f6e\u5f53\u524d",r.a.createElement("code",null,"hook"),"\u64cd\u4f5c\u4ee3\u7406",r.a.createElement("code",null,"ReactCurrentDispatcher"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u65b0\u589e\u8282\u70b9, \u8bbe\u7f6e\u4e3a",r.a.createElement("code",null,"HooksDispatcherOnMount")),r.a.createElement("li",null,"\u66f4\u65b0\u8282\u70b9, \u8bbe\u7f6e\u4e3a",r.a.createElement("code",null,"HooksDispatcherOnUpdate")))),r.a.createElement("li",null,"\u6267\u884c",r.a.createElement("code",null,"Component()"))),r.a.createElement("h3",{id:"\u521b\u5efa-hook"},r.a.createElement(o["AnchorLink"],{to:"#\u521b\u5efa-hook","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u521b\u5efa hook"),r.a.createElement("p",null,"\u5728\u6267\u884c",r.a.createElement("code",null,"Example()"),"\u7684\u65f6\u5019, \u8c03\u7528",r.a.createElement("code",null,"useState(0)")),r.a.createElement("p",null,"\u8ddf\u8fdb",r.a.createElement("code",null,"useState"),"\u903b\u8f91, \u6700\u7ec8\u6267\u884c",r.a.createElement("code",null,"ReactCurrentDispatcher.current.useState(initialState)"),"."),r.a.createElement("p",null,"\u65b0\u589e\u8282\u70b9, ",r.a.createElement("code",null,"useState"),"\u5bf9\u5e94",r.a.createElement("code",null,"mountState")),r.a.createElement(c["a"],{code:"function mountState<S>(\n  initialState: (() => S) | S,\n): [S, Dispatch<BasicStateAction<S>>] {\n  //1. \u521b\u5efahook\u5bf9\u8c61, \u5e76\u4e14\u6302\u8f7d\u5230\u5f53\u524d`fiber.memoizedState`\u4e0a,workInProgressHook\u6307\u5411\u5f53\u524dhook\n  const hook = mountWorkInProgressHook();\n  if (typeof initialState === 'function') {\n    // $FlowFixMe: Flow doesn't like mixed types\n    initialState = initialState();\n  }\n  //2. \u628ainitialState\u8bbe\u7f6e\u5230`hook`\u5bf9\u8c61\u4e2d\n  hook.memoizedState = hook.baseState = initialState;\n  //3. \u8bbe\u7f6ehook.queue\n  // \u8bbe\u7f6elastRenderedReducer,lastRenderedState,dispatch\n  const queue = (hook.queue = {\n    pending: null,\n    dispatch: null,\n    lastRenderedReducer: basicStateReducer,\n    lastRenderedState: (initialState: any),\n  });\n  // \u8bbe\u7f6equeue.dispatch, \u5f53\u524dfiber\u88ab\u5173\u8054\u5230queue.dispatch\u4e2d\n  const dispatch: Dispatch<\n    BasicStateAction<S>,\n  > = (queue.dispatch = (dispatchAction.bind(\n    null,\n    currentlyRenderingFiber,\n    queue,\n  ): any));\n  //4. \u8fd4\u56dedispatchAction\u64cd\u4f5c\u63a5\u53e3\n  return [hook.memoizedState, dispatch];\n}",lang:"js"}),r.a.createElement("p",null,"\u6838\u5fc3\u6b65\u9aa4:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u521b\u5efa",r.a.createElement("code",null,"hook"),"\u5bf9\u8c61, \u6302\u8f7d\u5230\u5f53\u524d",r.a.createElement("code",null,"fiber.memoizedState"),",",r.a.createElement("code",null,"workInProgressHook"),"\u6307\u5411\u6b64",r.a.createElement("code",null,"hook")),r.a.createElement("li",null,"\u8bbe\u7f6e",r.a.createElement("code",null,"hook.queue"),", \u548c\u5f53\u524d",r.a.createElement("code",null,"fiber"),"\u8fdb\u884c\u5173\u8054")),r.a.createElement("p",null,"\u65b0\u589e\u8282\u70b9, ",r.a.createElement("code",null,"useEffect"),"\u5bf9\u5e94",r.a.createElement("code",null,"mountEffect")),r.a.createElement(c["a"],{code:"function mountEffect(\n  create: () => (() => void) | void,\n  deps: Array<mixed> | void | null,\n): void {\n  // \u6ce8\u610f\u8fd9\u91cc\u6307\u5b9a\u4e86\u4e24\u79cdtag\n  return mountEffectImpl(\n    UpdateEffect | PassiveEffect, // fiber.effectTag \u9002\u7528\u4e8efiber\u5bf9\u8c61\n    HookPassive, // effect.tag \u9002\u7528\u4e8eeffect\u5bf9\u8c61\n    create,\n    deps,\n  );\n}\n\nfunction mountEffectImpl(fiberEffectTag, hookEffectTag, create, deps): void {\n  const hook = mountWorkInProgressHook();\n  const nextDeps = deps === undefined ? null : deps;\n  currentlyRenderingFiber.effectTag |= fiberEffectTag;\n  hook.memoizedState = pushEffect(\n    HookHasEffect | hookEffectTag, //\u518d\u6b21\u6307\u5b9a effect.tag\n    create,\n    undefined,\n    nextDeps,\n  );\n}\n\nfunction pushEffect(tag, create, destroy, deps) {\n  // \u521b\u5efa\u65b0\u7684effect\u5bf9\u8c61\n  const effect: Effect = {\n    tag,\n    create,\n    destroy,\n    deps,\n    // Circular\n    next: (null: any),\n  };\n  // \u5c06effect\u5bf9\u8c61\u6dfb\u52a0\u5230fiber.updateQueue\u961f\u5217\u4e2d\n  let componentUpdateQueue: null | FunctionComponentUpdateQueue = (currentlyRenderingFiber.updateQueue: any);\n  if (componentUpdateQueue === null) {\n    componentUpdateQueue = createFunctionComponentUpdateQueue();\n    currentlyRenderingFiber.updateQueue = (componentUpdateQueue: any);\n    componentUpdateQueue.lastEffect = effect.next = effect;\n  } else {\n    const lastEffect = componentUpdateQueue.lastEffect;\n    if (lastEffect === null) {\n      componentUpdateQueue.lastEffect = effect.next = effect;\n    } else {\n      const firstEffect = lastEffect.next;\n      lastEffect.next = effect;\n      effect.next = firstEffect;\n      componentUpdateQueue.lastEffect = effect;\n    }\n  }\n  return effect;\n}",lang:"js"}),r.a.createElement("p",null,"\u6838\u5fc3\u6b65\u9aa4:"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u521b\u5efa",r.a.createElement("code",null,"hook"),"\u5bf9\u8c61, \u5e76\u4e14\u6dfb\u52a0\u5230",r.a.createElement("code",null,"hook"),"\u961f\u5217\u4e2d,",r.a.createElement("code",null,"workInProgressHook"),"\u6307\u5411\u6b64",r.a.createElement("code",null,"hook")),r.a.createElement("li",null,"\u8bbe\u7f6e",r.a.createElement("code",null,"fiber.effectTag = UpdateEffect | PassiveEffect")),r.a.createElement("li",null,"\u521b\u5efa",r.a.createElement("code",null,"effect"),"\u5bf9\u8c61(\u8bbe\u7f6e",r.a.createElement("code",null,"effect.tag = HookHasEffect | HookPassive"),"), \u5e76\u5c06",r.a.createElement("code",null,"effect"),"\u6dfb\u52a0\u5230",r.a.createElement("code",null,"fiber.UpdateQueue"),"\u961f\u5217\u4e2d")),r.a.createElement("p",null,"\u5728\u6574\u4e2a\u521b\u5efa",r.a.createElement("code",null,"hook"),"\u9636\u6bb5, \u4e3b\u8981\u6d41\u7a0b\u8868\u793a\u5982\u4e0b:"),r.a.createElement("p",null,r.a.createElement("img",{src:t("4dQB"),alt:""})),r.a.createElement("h3",{id:"\u6267\u884c-hook"},r.a.createElement(o["AnchorLink"],{to:"#\u6267\u884c-hook","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6267\u884c hook"),r.a.createElement("p",null,"\u4ece\u4ee5\u4e0a\u6d41\u7a0b\u56fe\u53ef\u4ee5\u770b\u5230, \u6267\u884c",r.a.createElement("code",null,"function"),"\u7684\u65f6\u5019, \u53ea\u662f\u521b\u5efa\u4e86",r.a.createElement("code",null,"hook"),", \u4f46\u662f\u5e76\u6ca1\u6709\u6267\u884c",r.a.createElement("code",null,"hook.create"),".\u5728 fiber \u6784\u5efa(\u65b0\u589e\u8282\u70b9) \u4e2d\u6709\u4ecb\u7ecd, ",r.a.createElement("code",null,"commitRoot"),"\u5206\u4e3a",r.a.createElement(o["AnchorLink"],{to:"./render#commit%E9%98%B6%E6%AE%B5"},"3 \u4e2a\u9636\u6bb5")),r.a.createElement("p",null,"\u7b2c\u4e00\u4e2a\u9636\u6bb5",r.a.createElement("code",null,"commitBeforeMutationEffects"),"\u5bf9",r.a.createElement("code",null,"Passive"),"\u7c7b\u578b\u7684 tag \u505a\u4e86\u7279\u6b8a\u5904\u7406.\u5982\u679c",r.a.createElement("code",null,"function"),"\u7c7b\u578b\u7684",r.a.createElement("code",null,"fiber"),"\u4f7f\u7528\u4e86",r.a.createElement("code",null,"hook"),"api,\u4f1a\u8bbe\u7f6e",r.a.createElement("code",null,"fiber.effectTag |= Passive")),r.a.createElement(c["a"],{code:"function commitBeforeMutationEffects() {\n  while (nextEffect !== null) {\n    if (\n      !shouldFireAfterActiveInstanceBlur &&\n      focusedInstanceHandle !== null &&\n      isFiberHiddenOrDeletedAndContains(nextEffect, focusedInstanceHandle)\n    ) {\n      shouldFireAfterActiveInstanceBlur = true;\n      beforeActiveInstanceBlur();\n    }\n    const effectTag = nextEffect.effectTag;\n    // `Passive`\u7c7b\u578b\u7684tag\u505a\u4e86\u7279\u6b8a\u5904\u7406.\n    if ((effectTag & Passive) !== NoEffect) {\n      // If there are passive effects, schedule a callback to flush at\n      // the earliest opportunity.\n      if (!rootDoesHavePassiveEffects) {\n        rootDoesHavePassiveEffects = true;\n        // \u9700\u8981\u6ce8\u610f, \u6b64\u5904\u7684\u56de\u8c03\u51fd\u6570\u662f\u901a\u8fc7\u8c03\u5ea6\u5668\u6267\u884c\u7684, \u6240\u4ee5\u662f\u4e00\u4e2a\u5f02\u6b65\u56de\u8c03\n\n        scheduleCallback(NormalPriority, () => {\n          flushPassiveEffects(); // \u6267\u884chook\u7684\u5165\u53e3\n          return null;\n        });\n      }\n    }\n    nextEffect = nextEffect.nextEffect;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u5f02\u6b65\u56de\u8c03:"),r.a.createElement("p",null,r.a.createElement("code",null,"flushPassiveEffectsImpl -> commitPassiveHookEffects")),r.a.createElement(c["a"],{code:"export function commitPassiveHookEffects(finishedWork: Fiber): void {\n  if ((finishedWork.effectTag & Passive) !== NoEffect) {\n    switch (finishedWork.tag) {\n      case FunctionComponent:\n      case ForwardRef:\n      case SimpleMemoComponent:\n      case Block:\n          commitHookEffectListUnmount(\n            HookPassive | HookHasEffect,\n            finishedWork,\n          );\n          commitHookEffectListMount(HookPassive | HookHasEffect, finishedWork);\n        break;\n      }\n      default:\n        break;\n    }\n  }\n}\n// \u6267\u884cdestroy\u65b9\u6cd5\nfunction commitHookEffectListUnmount(tag: number, finishedWork: Fiber) {\n  const updateQueue: FunctionComponentUpdateQueue | null = (finishedWork.updateQueue: any);\n  const lastEffect = updateQueue !== null ? updateQueue.lastEffect : null;\n  if (lastEffect !== null) {\n    const firstEffect = lastEffect.next;\n    let effect = firstEffect;\n    do {\n      if ((effect.tag & tag) === tag) {\n        // Unmount\n        const destroy = effect.destroy;\n        effect.destroy = undefined;\n        if (destroy !== undefined) {\n          destroy();\n        }\n      }\n      effect = effect.next;\n    } while (effect !== firstEffect);\n  }\n}\n// \u6267\u884ccreate\u65b9\u6cd5\nfunction commitHookEffectListMount(tag: number, finishedWork: Fiber) {\n  const updateQueue: FunctionComponentUpdateQueue | null = (finishedWork.updateQueue: any);\n  const lastEffect = updateQueue !== null ? updateQueue.lastEffect : null;\n  if (lastEffect !== null) {\n    const firstEffect = lastEffect.next;\n    let effect = firstEffect;\n    do {\n      if ((effect.tag & tag) === tag) {\n        // Mount\n        const create = effect.create;\n        effect.destroy = create();\n      }\n      effect = effect.next;\n    } while (effect !== firstEffect);\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"\u66f4\u65b0\u9636\u6bb5"},r.a.createElement(o["AnchorLink"],{to:"#\u66f4\u65b0\u9636\u6bb5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u66f4\u65b0\u9636\u6bb5"),r.a.createElement("h4",{id:"dispatchaction-\u89e6\u53d1\u8c03\u5ea6"},r.a.createElement(o["AnchorLink"],{to:"#dispatchaction-\u89e6\u53d1\u8c03\u5ea6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"dispatchAction \u89e6\u53d1\u8c03\u5ea6"),r.a.createElement(c["a"],{code:"function dispatchAction<S, A>(\n  fiber: Fiber,\n  queue: UpdateQueue<S, A>,\n  action: A,\n) {\n  // 1. \u83b7\u53d6expirationTime\n  const currentTime = requestCurrentTimeForUpdate();\n  const suspenseConfig = requestCurrentSuspenseConfig();\n  const expirationTime = computeExpirationForFiber(\n    currentTime,\n    fiber,\n    suspenseConfig,\n  );\n\n  // 2. \u521b\u5efaupdate\u5bf9\u8c61\n  const update: Update<S, A> = {\n    expirationTime,\n    suspenseConfig,\n    action,\n    eagerReducer: null,\n    eagerState: null,\n    next: (null: any),\n  };\n  //3. \u5c06update\u5bf9\u8c61\u8bbe\u7f6e\u5230hook.queue\u961f\u5217\u5f53\u4e2d\n  // Append the update to the end of the list.\n  const pending = queue.pending;\n  if (pending === null) {\n    // This is the first update. Create a circular list.\n    update.next = update;\n  } else {\n    update.next = pending.next;\n    pending.next = update;\n  }\n  queue.pending = update;\n\n  const alternate = fiber.alternate;\n\n  //4. \u8bf7\u6c42\u8c03\u5ea6\n  scheduleUpdateOnFiber(fiber, expirationTime);\n  }\n}",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"dispatchAction"),"\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684",r.a.createElement("code",null,"update"),"\u5bf9\u8c61, \u6dfb\u52a0\u5230",r.a.createElement("code",null,"hook.queue.pending"),"\u961f\u5217\u4e4b\u540e."),r.a.createElement("p",null,r.a.createElement("img",{src:t("4z7d"),alt:""})),r.a.createElement("h3",{id:"\u66f4\u65b0-fiber"},r.a.createElement(o["AnchorLink"],{to:"#\u66f4\u65b0-fiber","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u66f4\u65b0 fiber"),r.a.createElement("p",null,r.a.createElement("code",null,"scheduleUpdateOnFiber"),"\u8bf7\u6c42\u8c03\u5ea6, \u968f\u540e\u518d\u6b21\u6784\u5efa",r.a.createElement("code",null,"fiber"),"\u6811, ",r.a.createElement("code",null,"renderWithHooks"),"\u4f5c\u4e3a\u6784\u5efa",r.a.createElement("code",null,"fiber"),"\u6811\u8fc7\u7a0b\u4e2d\u7684\u4e00\u73af, \u4e5f\u4f1a\u518d\u6b21\u6267\u884c."),r.a.createElement("h4",{id:"\u66f4\u65b0-hook"},r.a.createElement(o["AnchorLink"],{to:"#\u66f4\u65b0-hook","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u66f4\u65b0 hook"),r.a.createElement("p",null,r.a.createElement("code",null,"renderWithHooks"),"\u8c03\u7528\u6808\u4e2d, \u6267\u884c",r.a.createElement("code",null,"\bExample"),"\u51fd\u6570\u4f53, \u8c03\u7528",r.a.createElement("code",null,"useState"),",",r.a.createElement("code",null,"useEffect"),"\u7b49\u51fd\u6570\u91cd\u65b0\u6784\u9020",r.a.createElement("code",null,"hook"),"\u5bf9\u8c61."),r.a.createElement("blockquote",null,r.a.createElement("p",null,r.a.createElement("code",null,"currentHook"),"\u548c",r.a.createElement("code",null,"workInProgressHook"),"\u662f\u4e24\u4e2a\u6307\u9488, \u5206\u522b\u6307\u5411\u8001",r.a.createElement("code",null,"hook"),"\u548c\u65b0",r.a.createElement("code",null,"hook"))),r.a.createElement("p",null,r.a.createElement("code",null,"updateWorkInProgressHook"),"\u7ef4\u62a4\u4e86\u5f53\u524d",r.a.createElement("code",null,"fiber"),"\u8282\u70b9",r.a.createElement("code",null,"\u65b0\u65e7hook"),"\u6307\u9488\u7684\u79fb\u52a8, \u4fdd\u8bc1",r.a.createElement("code",null,"currentHook"),"\u548c",r.a.createElement("code",null,"workInProgressHook"),"\u6709\u6b63\u786e\u7684\u6307\u5411"),r.a.createElement(c["a"],{code:"function updateWorkInProgressHook(): Hook {\n  let nextCurrentHook: null | Hook;\n  // \u521a\u8fdb\u5165\u8be5fiber\u8282\u70b9, currentHook\u4e3anull\n  if (currentHook === null) {\n    // \u62ff\u5230\u5f53\u524dfiber\u8282\u70b9\u7684\u526f\u672c(\u5bf9\u5e94\u8001\u8282\u70b9)\n    const current = currentlyRenderingFiber.alternate;\n    if (current !== null) {\n      nextCurrentHook = current.memoizedState;\n    } else {\n      nextCurrentHook = null;\n    }\n  } else {\n    nextCurrentHook = currentHook.next;\n  }\n\n  let nextWorkInProgressHook: null | Hook;\n  if (workInProgressHook === null) {\n    nextWorkInProgressHook = currentlyRenderingFiber.memoizedState;\n  } else {\n    nextWorkInProgressHook = workInProgressHook.next;\n  }\n\n  if (nextWorkInProgressHook !== null) {\n    // There's already a work-in-progress. Reuse it.\n    workInProgressHook = nextWorkInProgressHook;\n    nextWorkInProgressHook = workInProgressHook.next;\n\n    currentHook = nextCurrentHook;\n  } else {\n    // Clone from the current hook.\n    currentHook = nextCurrentHook;\n    // \u521b\u5efa\u65b0\u7684hook\u8282\u70b9, \u6700\u540e\u6dfb\u52a0\u5230\u961f\u5217\n    const newHook: Hook = {\n      memoizedState: currentHook.memoizedState,\n\n      baseState: currentHook.baseState,\n      baseQueue: currentHook.baseQueue,\n      queue: currentHook.queue,\n\n      next: null,\n    };\n\n    if (workInProgressHook === null) {\n      // This is the first hook in the list.\n      currentlyRenderingFiber.memoizedState = workInProgressHook = newHook;\n    } else {\n      // Append to the end of the list.\n      workInProgressHook = workInProgressHook.next = newHook;\n    }\n  }\n  return workInProgressHook;\n}",lang:"js"}),r.a.createElement("p",null,"\u5bf9\u4e8e",r.a.createElement("code",null,"useState"),", \u8c03\u7528",r.a.createElement("code",null,"updateReducer"),":"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u8c03\u7528",r.a.createElement("code",null,"updateWorkInProgressHook"),"\u521b\u5efa\u65b0\u7684",r.a.createElement("code",null,"hook"),"\u5bf9\u8c61",r.a.createElement("ul",null,r.a.createElement("li",null,"\u6ce8\u610f\u65b0",r.a.createElement("code",null,"hook"),"\u5b9e\u9645\u4e0a\u662f\u65e7",r.a.createElement("code",null,"hook"),"\u7684\u6d45\u62f7\u8d1d")))),r.a.createElement("p",null,r.a.createElement("img",{src:t("v3TJ"),alt:""})),r.a.createElement("ol",{start:2},r.a.createElement("li",null,"\u5982\u679c",r.a.createElement("code",null,"hook.queue.pending !=== null"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u904d\u5386",r.a.createElement("code",null,"hook.queue.pending"),"\u961f\u5217, \u63d0\u53d6\u8db3\u591f\u4f18\u5148\u7ea7\u7684",r.a.createElement("code",null,"update"),"\u5bf9\u8c61, \u751f\u6210",r.a.createElement("code",null,"newState")),r.a.createElement("li",null,"\u66f4\u65b0",r.a.createElement("code",null,"hook"),"\u548c",r.a.createElement("code",null,"queue"),"\u5bf9\u8c61\u7684\u76f8\u5173\u5c5e\u6027")))),r.a.createElement("p",null,r.a.createElement("img",{src:t("gpAG"),alt:""})),r.a.createElement("p",null,"\u6700\u540e\u8fd4\u56de\u65b0\u7684\u5143\u7ec4",r.a.createElement("code",null,"[hook.memoizedState, dispatch]")),r.a.createElement(c["a"],{code:"function updateReducer<S, I, A>(\n  reducer: (S, A) => S,\n  initialArg: I,\n  init?: I => S,\n): [S, Dispatch<A>] {\n  const hook = updateWorkInProgressHook();\n  const queue = hook.queue;\n  queue.lastRenderedReducer = reducer;\n  const current: Hook = (currentHook: any);\n  // The last rebase update that is NOT part of the base state.\n  let baseQueue = current.baseQueue;\n  // The last pending update that hasn't been processed yet.\n  const pendingQueue = queue.pending;\n  if (pendingQueue !== null) {\n    // We have new updates that haven't been processed yet.\n    // We'll add them to the base queue.\n    if (baseQueue !== null) {\n      // Merge the pending queue and the base queue.\n      const baseFirst = baseQueue.next;\n      const pendingFirst = pendingQueue.next;\n      baseQueue.next = pendingFirst;\n      pendingQueue.next = baseFirst;\n    }\n    current.baseQueue = baseQueue = pendingQueue;\n    queue.pending = null;\n  }\n\n  if (baseQueue !== null) {\n    // We have a queue to process.\n    const first = baseQueue.next;\n    let newState = current.baseState;\n\n    let newBaseState = null;\n    let newBaseQueueFirst = null;\n    let newBaseQueueLast = null;\n    let update = first;\n    do {\n      const updateExpirationTime = update.expirationTime;\n      if (updateExpirationTime < renderExpirationTime) {\n        // Priority is insufficient. Skip this update. If this is the first\n        // skipped update, the previous update/state is the new base\n        // update/state.\n        const clone: Update<S, A> = {\n          expirationTime: update.expirationTime,\n          suspenseConfig: update.suspenseConfig,\n          action: update.action,\n          eagerReducer: update.eagerReducer,\n          eagerState: update.eagerState,\n          next: (null: any),\n        };\n        if (newBaseQueueLast === null) {\n          newBaseQueueFirst = newBaseQueueLast = clone;\n          newBaseState = newState;\n        } else {\n          newBaseQueueLast = newBaseQueueLast.next = clone;\n        }\n        // Update the remaining priority in the queue.\n        if (updateExpirationTime > currentlyRenderingFiber.expirationTime) {\n          currentlyRenderingFiber.expirationTime = updateExpirationTime;\n          markUnprocessedUpdateTime(updateExpirationTime);\n        }\n      } else {\n        // This update does have sufficient priority.\n\n        if (newBaseQueueLast !== null) {\n          const clone: Update<S, A> = {\n            expirationTime: Sync, // This update is going to be committed so we never want uncommit it.\n            suspenseConfig: update.suspenseConfig,\n            action: update.action,\n            eagerReducer: update.eagerReducer,\n            eagerState: update.eagerState,\n            next: (null: any),\n          };\n          newBaseQueueLast = newBaseQueueLast.next = clone;\n        }\n\n        // Mark the event time of this update as relevant to this render pass.\n        // TODO: This should ideally use the true event time of this update rather than\n        // its priority which is a derived and not reverseable value.\n        // TODO: We should skip this update if it was already committed but currently\n        // we have no way of detecting the difference between a committed and suspended\n        // update here.\n        markRenderEventTimeAndConfig(\n          updateExpirationTime,\n          update.suspenseConfig,\n        );\n\n        // Process this update.\n        if (update.eagerReducer === reducer) {\n          // If this update was processed eagerly, and its reducer matches the\n          // current reducer, we can use the eagerly computed state.\n          newState = ((update.eagerState: any): S);\n        } else {\n          const action = update.action;\n          newState = reducer(newState, action);\n        }\n      }\n      update = update.next;\n    } while (update !== null && update !== first);\n\n    if (newBaseQueueLast === null) {\n      newBaseState = newState;\n    } else {\n      newBaseQueueLast.next = (newBaseQueueFirst: any);\n    }\n\n    // Mark that the fiber performed work, but only if the new state is\n    // different from the current state.\n    if (!is(newState, hook.memoizedState)) {\n      markWorkInProgressReceivedUpdate();\n    }\n\n    hook.memoizedState = newState;\n    hook.baseState = newBaseState;\n    hook.baseQueue = newBaseQueueLast;\n\n    queue.lastRenderedState = newState;\n  }\n\n  const dispatch: Dispatch<A> = (queue.dispatch: any);\n  return [hook.memoizedState, dispatch];\n}",lang:"js"}),r.a.createElement("p",null,"\u5bf9\u4e8e",r.a.createElement("code",null,"useEffect"),", \u8c03\u7528",r.a.createElement("code",null,"updateEffectImpl"),":"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u8c03\u7528",r.a.createElement("code",null,"updateWorkInProgressHook"),"\u521b\u5efa\u65b0\u7684",r.a.createElement("code",null,"hook"),"\u5bf9\u8c61",r.a.createElement("ul",null,r.a.createElement("li",null,"\u548c",r.a.createElement("code",null,"useState"),"\u4e2d\u662f\u4e00\u81f4\u7684(\u4e0d\u540c\u7684\u662f, \u901a\u8fc7",r.a.createElement("code",null,"useEffect"),"\u521b\u5efa\u7684",r.a.createElement("code",null,"hook"),"\u5bf9\u8c61,",r.a.createElement("code",null,"hook.queue = null"),")")))),r.a.createElement("p",null,r.a.createElement("img",{src:t("AbAg"),alt:""})),r.a.createElement("ol",{start:2},r.a.createElement("li",null,r.a.createElement("p",null,"\u751f\u6210\u65b0\u7684",r.a.createElement("code",null,"effect"),"\u5bf9\u8c61"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"hook \u66f4\u65b0,\u5e76\u4e14 deps \u4f9d\u8d56\u4e0d\u53d8."),r.a.createElement("ul",null,r.a.createElement("li",null,"\u751f\u6210\u65b0\u7684",r.a.createElement("code",null,"effect(HookPassive)"),",\u6dfb\u52a0\u5230",r.a.createElement("code",null,"fiber.updateQueue"))),r.a.createElement("p",null,r.a.createElement("img",{src:t("Kn9z"),alt:""}))),r.a.createElement("li",null,r.a.createElement("p",null,"deps \u4f9d\u8d56\u6539\u53d8."),r.a.createElement("ul",null,r.a.createElement("li",null,"\u8bbe\u7f6e",r.a.createElement("code",null,"fier.effectTag = UpdateEffect | PassiveEffect")),r.a.createElement("li",null,"\u751f\u6210\u65b0\u7684",r.a.createElement("code",null,"effect(HookHasEffect | HookPassive)"),",\u6dfb\u52a0\u5230",r.a.createElement("code",null,"fiber.updateQueue"))),r.a.createElement("p",null,r.a.createElement("img",{src:t("1XtG"),alt:""})))))),r.a.createElement(c["a"],{code:"function updateEffectImpl(fiberEffectTag, hookEffectTag, create, deps): void {\n  const hook = updateWorkInProgressHook();\n  const nextDeps = deps === undefined ? null : deps;\n  let destroy = undefined;\n  if (currentHook !== null) {\n    // hook\u66f4\u65b0\n    const prevEffect = currentHook.memoizedState;\n    destroy = prevEffect.destroy;\n    if (nextDeps !== null) {\n      const prevDeps = prevEffect.deps;\n      if (areHookInputsEqual(nextDeps, prevDeps)) {\n        // deps\u4f9d\u8d56\u4e00\u81f4\n        pushEffect(hookEffectTag, create, destroy, nextDeps);\n        return;\n      }\n    }\n  }\n  // \u65b0\u589ehook, \u6216\u8005deps\u4f9d\u8d56\u6539\u53d8\n  // 1. \u8bbe\u7f6efier.effectTag = UpdateEffect | PassiveEffect\n  currentlyRenderingFiber.effectTag |= fiberEffectTag;\n  // 2. \u8bbe\u7f6ehook.memoizedState\n  hook.memoizedState = pushEffect(\n    HookHasEffect | hookEffectTag,\n    create,\n    destroy,\n    nextDeps,\n  );\n}",lang:"js"}),r.a.createElement("p",null,"\u6574\u4e2a",r.a.createElement("code",null,"hook"),"\u7684\u66f4\u65b0\u8fc7\u7a0b\u53ef\u4ee5\u5982\u4e0b\u8868\u793a:"),r.a.createElement("p",null,"\u5de6\u8fb9\u662f",r.a.createElement("code",null,"current"),"\u53f3\u8fb9\u662f",r.a.createElement("code",null,"workInProgress")),r.a.createElement("p",null,r.a.createElement("img",{src:t("LA/F"),alt:""})),r.a.createElement("p",null,"\u6ce8\u610f\u6d45\u84dd\u8272\u80cc\u666f\u7684",r.a.createElement("code",null,"updateQueue"),"\u961f\u5217\u4e2d, \u65b0",r.a.createElement("code",null,"effect"),"\u4f1a\u5f15\u7528\u65e7",r.a.createElement("code",null,"effect"),"\u5bf9\u8c61\u7684",r.a.createElement("code",null,"destroy"),"\u65b9\u6cd5.")))))},Zs1V:function(e){e.exports=JSON.parse("{}")},gpAG:function(e,n,t){e.exports=t.p+"static/useState-update-WorkInProgressHook.eba58ac7.png"},v3TJ:function(e,n,t){e.exports=t.p+"static/useState-create-WorkInProgressHook.3203c37f.png"}}]);